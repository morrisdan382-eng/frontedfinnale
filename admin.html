<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Admin Dashboard - Smart Lighting and Temparature Monitoring System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Performance optimizations -->
  <link rel="preload" href="assets/logo.png" as="image">
  <link rel="preload" href="assets/thermometer.png" as="image">
  <link rel="preload" href="assets/bulb_on.png" as="image">
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  
  <style>
    /* Base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Header */
    .header-hero {
      background: linear-gradient(135deg, #0a3d62 0%, #1e5f8e 100%);
      color: white;
      padding: 20px 30px;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
    }
    
    .header-hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("assets/room.jpg") center/cover no-repeat;
      opacity: 0.2;
      z-index: 0;
    }
    
    .header-hero > * {
      position: relative;
      z-index: 1;
    }
    
    .header-hero .logo {
      width: 60px;
      height: auto;
      margin-right: 20px;
      transition: transform 0.3s ease;
    }
    
    .header-hero .logo:hover {
      transform: scale(1.05);
    }
    
    .title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .subtitle {
      font-size: 16px;
      opacity: 0.9;
    }
    
    /* Container */
    .container {
      flex: 1;
      padding: 20px 30px;
      max-width: 1400px;
      width: 100%;
      margin: 0 auto;
    }
    
    /* Cards */
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      padding: 25px;
      margin-bottom: 20px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    }
    
    /* User Info Card */
    .user-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .user-details h2 {
      color: #0a3d62;
      margin-bottom: 5px;
      font-size: 22px;
    }
    
    .user-details p {
      color: #666;
      font-size: 14px;
    }
    
    /* Buttons */
    .btn {
      background: linear-gradient(135deg, #0077ff, #005fe0);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    
    .btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #005fe0, #0047b3);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,119,255,0.3);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .btn.secondary {
      background: #f0f0f0;
      color: #333;
    }
    
    .btn.secondary:hover:not(:disabled) {
      background: #e0e0e0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .btn.danger {
      background: linear-gradient(135deg, #ff4444, #cc0000);
    }
    
    .btn.danger:hover:not(:disabled) {
      background: linear-gradient(135deg, #cc0000, #990000);
    }
    
    .btn.success {
      background: linear-gradient(135deg, #4caf50, #388e3c);
    }
    
    .btn.success:hover:not(:disabled) {
      background: linear-gradient(135deg, #388e3c, #2e7d32);
    }
    
    /* Simulation Controls */
    .controls-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .controls-left {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .stat {
      display: flex;
      align-items: center;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    
    .stat:hover {
      background: #f0f1f3;
      transform: translateY(-2px);
    }
    
    .stat img {
      width: 40px;
      height: 40px;
      margin-right: 12px;
    }
    
    .stat .value {
      font-size: 24px;
      font-weight: 600;
      color: #0a3d62;
    }
    
    .stat .label {
      font-size: 12px;
      color: #666;
      margin-top: 2px;
    }
    
    #simTime {
      font-size: 14px;
      color: #666;
      padding: 8px 12px;
      background: #f0f0f0;
      border-radius: 20px;
    }
    
    .controls-right {
      display: flex;
      gap: 10px;
    }
    
    /* System Overview */
    .system-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .overview-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }
    
    .overview-item .value {
      font-size: 20px;
      font-weight: 600;
      color: #0a3d62;
    }
    
    .overview-item .label {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    
    /* Room Cards */
    .room-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .room-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      transition: all 0.3s ease;
    }
    
    .room-card:hover {
      background: #f0f1f3;
      transform: translateY(-2px);
    }
    
    .room-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .room-name {
      font-size: 18px;
      font-weight: 600;
      color: #0a3d62;
    }
    
    .room-status {
      display: flex;
      gap: 10px;
      font-size: 12px;
    }
    
    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 500;
    }
    
    .status-badge.active {
      background: #e8f5e9;
      color: #2e7d32;
    }
    
    .status-badge.inactive {
      background: #f5f5f5;
      color: #757575;
    }
    
    /* Light Controls */
    .light-controls {
      margin-bottom: 15px;
    }
    
    .control-label {
      font-size: 14px;
      font-weight: 500;
      color: #666;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .brightness-bar {
      display: flex;
      gap: 2px;
      margin-bottom: 8px;
    }
    
    .brightness-segment {
      flex: 1;
      height: 8px;
      background: #e0e0e0;
      border-radius: 2px;
      transition: background 0.3s ease;
    }
    
    .brightness-segment.active {
      background: #ffc107;
    }
    
    .brightness-controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .brightness-btn {
      width: 30px;
      height: 30px;
      border: none;
      background: #0077ff;
      color: white;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .brightness-btn:hover {
      background: #005fe0;
      transform: scale(1.1);
    }
    
    .brightness-value {
      flex: 1;
      text-align: center;
      font-weight: 500;
      color: #0a3d62;
    }
    
    .brightness-presets {
      display: flex;
      gap: 5px;
      margin-top: 8px;
    }
    
    .preset-btn {
      flex: 1;
      padding: 4px 8px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .preset-btn:hover {
      background: #0077ff;
      color: white;
      border-color: #0077ff;
    }
    
    /* Temperature Controls */
    .temp-controls {
      margin-bottom: 15px;
    }
    
    .temp-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .temp-current {
      font-size: 24px;
      font-weight: 600;
    }
    
    .temp-current.high {
      color: #f44336;
    }
    
    .temp-current.normal {
      color: #4caf50;
    }
    
    .temp-current.low {
      color: #2196f3;
    }
    
    .temp-target {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .temp-input {
      width: 60px;
      padding: 4px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
      font-size: 14px;
    }
    
    .hvac-controls {
      display: flex;
      gap: 8px;
    }
    
    .hvac-btn {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }
    
    .hvac-btn:hover {
      background: #f0f0f0;
    }
    
    .hvac-btn.active {
      background: #0077ff;
      color: white;
      border-color: #0077ff;
    }
    
    .hvac-btn.ac.active {
      background: #2196f3;
      border-color: #2196f3;
    }
    
    .hvac-btn.heater.active {
      background: #ff5722;
      border-color: #ff5722;
    }
    
    .hvac-btn.auto.active {
      background: #4caf50;
      border-color: #4caf50;
    }
    
    /* Energy Display */
    .energy-display {
      background: white;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
      font-size: 14px;
      color: #666;
    }
    
    .energy-value {
      font-size: 16px;
      font-weight: 600;
      color: #0a3d62;
    }
    
    /* Alerts */
    .alert-box {
      max-height: 200px;
      overflow-y: auto;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
      border-left: 4px solid #0077ff;
    }
    
    .alert {
      padding: 10px 15px;
      margin-bottom: 10px;
      border-radius: 6px;
      font-size: 14px;
      animation: fadeIn 0.3s ease;
    }
    
    .alert:last-child {
      margin-bottom: 0;
    }
    
    .alert.info {
      background: #e3f2fd;
      color: #0d47a1;
      border-left: 3px solid #2196f3;
    }
    
    .alert.warning {
      background: #fff8e1;
      color: #ff6f00;
      border-left: 3px solid #ffc107;
    }
    
    .alert.success {
      background: #e8f5e9;
      color: #2e7d32;
      border-left: 3px solid #4caf50;
    }
    
    .alert.error {
      background: #ffebee;
      color: #c62828;
      border-left: 3px solid #f44336;
    }
    
    /* Footer */
    .page-footer {
      text-align: center;
      padding: 20px;
      color: #666;
      font-size: 14px;
      background: #f0f0f0;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .header-hero {
        padding: 15px 20px;
      }
      
      .title {
        font-size: 20px;
      }
      
      .container {
        padding: 15px 20px;
      }
      
      .controls-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .controls-left {
        justify-content: center;
      }
      
      .controls-right {
        justify-content: center;
      }
      
      .user-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .room-grid {
        grid-template-columns: 1fr;
      }
    }
    
    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
      margin-left: 8px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header-hero">
    <img class="logo" src="assets/logo.png" alt="Smart Lighting System Logo" onerror="this.style.display='none'">
    <div>
      <div class="title">Smart Lighting & Temperature Monitoring System</div>
      <div class="subtitle">Admin Dashboard</div>
    </div>
  </header>

  <!-- Main Container -->
  <main class="container">
    <!-- User Info Card -->
    <section class="card">
      <div class="user-info">
        <div class="user-details">
          <h2 id="welcomeMsg">Welcome, Admin</h2>
          <p id="roleDisplay">Role: System Administrator</p>
          <p id="lastLogin">Last login: --</p>
        </div>
        <div>
          <button class="btn secondary" id="logoutBtn">Logout</button>
        </div>
      </div>
    </section>

    <!-- Simulation Controls -->
    <section class="card">
      <h3 style="margin-bottom: 15px;">System Simulation</h3>
      <div class="controls-row">
        <div class="controls-left">
          <div class="stat">
            <img src="assets/thermometer.png" alt="Temperature Icon">
            <div>
              <div class="value" id="avgTemp">--¬∞C</div>
              <div class="label">Average Temperature</div>
            </div>
          </div>

          <div class="stat">
            <img src="assets/bulb_on.png" alt="Light Icon">
            <div>
              <div class="value" id="lightsOn">--</div>
              <div class="label">Lights ON</div>
            </div>
          </div>

          <div class="stat">
            <img src="assets/energy.png" alt="Energy Icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xMyAyTDMgMTRoOWwtMSA4IDEwLTEyaC05bDEtOHoiPjwvcGF0aD48L3N2Zz4='">
            <div>
              <div class="value" id="energyUsage">-- kWh</div>
              <div class="label">Total Energy</div>
            </div>
          </div>

          <div id="simTime">Sim time: 0s</div>
        </div>

        <div class="controls-right">
          <button class="btn" id="startSim">
            Start Simulation
            <span class="spinner" style="display:none;"></span>
          </button>
          <button class="btn secondary" id="stopSim" disabled>Stop</button>
          <button class="btn secondary" id="resetSim">Reset</button>
        </div>
      </div>
    </section>

    <!-- System Overview -->
    <section class="card">
      <h3 style="margin-bottom: 15px;">System Overview</h3>
      <div class="system-overview">
        <div class="overview-item">
          <div class="value" id="totalLights">0</div>
          <div class="label">Total Lights</div>
        </div>
        <div class="overview-item">
          <div class="value" id="activeAC">0</div>
          <div class="label">Active AC Units</div>
        </div>
        <div class="overview-item">
          <div class="value" id="activeHeaters">0</div>
          <div class="label">Active Heaters</div>
        </div>
        <div class="overview-item">
          <div class="value" id="avgBrightness">0%</div>
          <div class="label">Avg Brightness</div>
        </div>
      </div>
    </section>

    <!-- Alerts -->
    <section class="card">
      <h3 style="margin-bottom: 15px;">System Alerts</h3>
      <div id="alerts" class="alert-box" role="status" aria-live="polite">
        <div class="alert info">System initialized. No alerts at this time.</div>
      </div>
    </section>

    <!-- Rooms Overview -->
    <section class="card">
      <h3>Rooms Control Panel</h3>
      <div class="room-grid" id="roomGrid">
        <!-- Room cards will be populated here -->
      </div>
    </section>

    <!-- Footer -->
    <footer class="page-footer">¬© Smart Lighting System 2025 ‚Äî Admin Dashboard</footer>
  </main>

  <script>
    // DOM Elements
    const startBtn = document.getElementById('startSim');
    const stopBtn = document.getElementById('stopSim');
    const resetBtn = document.getElementById('resetSim');
    const logoutBtn = document.getElementById('logoutBtn');
    const simTimeEl = document.getElementById('simTime');
    const avgTempEl = document.getElementById('avgTemp');
    const lightsOnEl = document.getElementById('lightsOn');
    const energyUsageEl = document.getElementById('energyUsage');
    const alertsEl = document.getElementById('alerts');
    const roomGridEl = document.getElementById('roomGrid');
    const welcomeMsgEl = document.getElementById('welcomeMsg');
    const lastLoginEl = document.getElementById('lastLogin');
    
    // Overview elements
    const totalLightsEl = document.getElementById('totalLights');
    const activeACEl = document.getElementById('activeAC');
    const activeHeatersEl = document.getElementById('activeHeaters');
    const avgBrightnessEl = document.getElementById('avgBrightness');
    
    // Simulation state
    let simulationInterval;
    let simulationTime = 0;
    let isSimulationRunning = false;
    let updateInterval = 3000; // Default 3 seconds
    
    // Room data with enhanced properties
    const rooms = [
      { 
        id: 1, 
        name: 'Guest Room 1', 
        temp: 22, 
        targetTemp: 22,
        lightOn: true, 
        brightness: 75,
        acOn: false,
        heaterOn: false,
        autoMode: true,
        energyUsage: 0.5 
      },
      { 
        id: 2, 
        name: 'Guest Room 2', 
        temp: 20, 
        targetTemp: 20,
        lightOn: false, 
        brightness: 0,
        acOn: false,
        heaterOn: false,
        autoMode: true,
        energyUsage: 0.2 
      },
      { 
        id: 3, 
        name: 'Guest Room 3', 
        temp: 24, 
        targetTemp: 22,
        lightOn: true, 
        brightness: 100,
        acOn: false,
        heaterOn: false,
        autoMode: true,
        energyUsage: 0.8 
      },
      { 
        id: 4, 
        name: 'Guest Room 4', 
        temp: 23, 
        targetTemp: 23,
        lightOn: false, 
        brightness: 0,
        acOn: false,
        heaterOn: false,
        autoMode: true,
        energyUsage: 0.3 
      },
      { 
        id: 5, 
        name: 'Guest Room 5', 
        temp: 21, 
        targetTemp: 21,
        lightOn: true, 
        brightness: 60,
        acOn: false,
        heaterOn: false,
        autoMode: true,
        energyUsage: 0.6 
      }
    ];
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      updateLastLogin();
      renderRoomCards();
      updateStats();
      
      // Event listeners
      startBtn.addEventListener('click', startSimulation);
      stopBtn.addEventListener('click', stopSimulation);
      resetBtn.addEventListener('click', resetSimulation);
      logoutBtn.addEventListener('click', logout);
    });
    
    // Update last login time
    function updateLastLogin() {
      const now = new Date();
      const formattedTime = now.toLocaleString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      lastLoginEl.textContent = `Last login: ${formattedTime}`;
    }
    
    // Render room cards
    function renderRoomCards() {
      roomGridEl.innerHTML = '';
      
      rooms.forEach(room => {
        const roomCard = document.createElement('div');
        roomCard.className = 'room-card';
        roomCard.innerHTML = `
          <div class="room-header">
            <div class="room-name">${room.name}</div>
            <div class="room-status">
              <span class="status-badge ${room.lightOn ? 'active' : 'inactive'}">
                üí° ${room.lightOn ? 'ON' : 'OFF'}
              </span>
              <span class="status-badge ${room.acOn ? 'active' : 'inactive'}">
                ‚ùÑÔ∏è ${room.acOn ? 'AC' : ''}
              </span>
              <span class="status-badge ${room.heaterOn ? 'active' : 'inactive'}">
                üî• ${room.heaterOn ? 'Heat' : ''}
              </span>
            </div>
          </div>
          
          <!-- Light Controls -->
          <div class="light-controls">
            <div class="control-label">
              <span>Light Control</span>
              <span>${room.lightOn ? 'ON' : 'OFF'}</span>
            </div>
            <div class="brightness-bar">
              ${generateBrightnessBar(room.brightness)}
            </div>
            <div class="brightness-controls">
              <button class="brightness-btn" onclick="adjustBrightness(${room.id}, -10)">-</button>
              <div class="brightness-value">${room.brightness}%</div>
              <button class="brightness-btn" onclick="adjustBrightness(${room.id}, 10)">+</button>
            </div>
            <div class="brightness-presets">
              <button class="preset-btn" onclick="setBrightness(${room.id}, 25)">25%</button>
              <button class="preset-btn" onclick="setBrightness(${room.id}, 50)">50%</button>
              <button class="preset-btn" onclick="setBrightness(${room.id}, 75)">75%</button>
              <button class="preset-btn" onclick="setBrightness(${room.id}, 100)">100%</button>
            </div>
          </div>
          
          <!-- Temperature Controls -->
          <div class="temp-controls">
            <div class="control-label">
              <span>Temperature Control</span>
              <span>Auto: ${room.autoMode ? 'ON' : 'OFF'}</span>
            </div>
            <div class="temp-display">
              <div class="temp-current ${getTempClass(room.temp)}">${room.temp}¬∞C</div>
              <div class="temp-target">
                Target: 
                <input type="number" class="temp-input" value="${room.targetTemp}" 
                       onchange="setTargetTemp(${room.id}, this.value)" min="16" max="30">¬∞C
              </div>
            </div>
            <div class="hvac-controls">
              <button class="hvac-btn ac ${room.acOn ? 'active' : ''}" 
                      onclick="toggleAC(${room.id})">
                ‚ùÑÔ∏è AC
              </button>
              <button class="hvac-btn heater ${room.heaterOn ? 'active' : ''}" 
                      onclick="toggleHeater(${room.id})">
                üî• Heat
              </button>
              <button class="hvac-btn auto ${room.autoMode ? 'active' : ''}" 
                      onclick="toggleAuto(${room.id})">
                üîÑ Auto
              </button>
            </div>
          </div>
          
          <!-- Energy Display -->
          <div class="energy-display">
            Energy Usage: <span class="energy-value">${room.energyUsage.toFixed(2)} kWh</span>
          </div>
        `;
        
        roomGridEl.appendChild(roomCard);
      });
    }
    
    // Generate brightness bar
    function generateBrightnessBar(brightness) {
      let bar = '';
      for (let i = 0; i < 10; i++) {
        const active = i < (brightness / 10);
        bar += `<div class="brightness-segment ${active ? 'active' : ''}"></div>`;
      }
      return bar;
    }
    
    // Get temperature class
    function getTempClass(temp) {
      if (temp > 28) return 'high';
      if (temp < 18) return 'low';
      return 'normal';
    }
    
    // Light control functions
    function toggleLight(roomId) {
      const room = rooms.find(r => r.id === roomId);
      if (room) {
        room.lightOn = !room.lightOn;
        if (!room.lightOn) {
          room.brightness = 0;
        } else if (room.brightness === 0) {
          room.brightness = 50;
        }
        renderRoomCards();
        updateStats();
        addAlert(`Light in ${room.name} turned ${room.lightOn ? 'ON' : 'OFF'}`, 'info');
      }
    }
    
    function adjustBrightness(roomId, delta) {
      const room = rooms.find(r => r.id === roomId);
      if (room) {
        room.brightness = Math.max(0, Math.min(100, room.brightness + delta));
        room.lightOn = room.brightness > 0;
        renderRoomCards();
        updateStats();
        addAlert(`${room.name} brightness adjusted to ${room.brightness}%`, 'info');
      }
    }
    
    function setBrightness(roomId, brightness) {
      const room = rooms.find(r => r.id === roomId);
      if (room) {
        room.brightness = brightness;
        room.lightOn = brightness > 0;
        renderRoomCards();
        updateStats();
        addAlert(`${room.name} brightness set to ${brightness}%`, 'info');
      }
    }
    
    // Temperature control functions
    function setTargetTemp(roomId, targetTemp) {
      const room = rooms.find(r => r.id === roomId);
      if (room) {
        room.targetTemp = parseInt(targetTemp);
        addAlert(`${room.name} target temperature set to ${room.targetTemp}¬∞C`, 'info');
        if (room.autoMode) {
          checkAutoMode(room);
        }
      }
    }
    
    function toggleAC(roomId) {
      const room = rooms.find(r => r.id === roomId);
      if (room) {
        room.acOn = !room.acOn;
        if (room.acOn) {
          room.heaterOn = false;
        }
        renderRoomCards();
        updateStats();
        addAlert(`AC in ${room.name} turned ${room.acOn ? 'ON' : 'OFF'}`, 'info');
      }
    }
    
    function toggleHeater(roomId) {
      const room = rooms.find(r => r.id === roomId);
      if (room) {
        room.heaterOn = !room.heaterOn;
        if (room.heaterOn) {
          room.acOn = false;
        }
        renderRoomCards();
        updateStats();
        addAlert(`Heater in ${room.name} turned ${room.heaterOn ? 'ON' : 'OFF'}`, 'info');
      }
    }
    
    function toggleAuto(roomId) {
      const room = rooms.find(r => r.id === roomId);
      if (room) {
        room.autoMode = !room.autoMode;
        if (room.autoMode) {
          checkAutoMode(room);
        }
        renderRoomCards();
        addAlert(`Auto mode in ${room.name} turned ${room.autoMode ? 'ON' : 'OFF'}`, 'info');
      }
    }
    
    function checkAutoMode(room) {
      if (!room.autoMode) return;
      
      if (room.temp > room.targetTemp + 2) {
        room.acOn = true;
        room.heaterOn = false;
      } else if (room.temp < room.targetTemp - 2) {
        room.heaterOn = true;
        room.acOn = false;
      } else {
        room.acOn = false;
        room.heaterOn = false;
      }
    }
    
    // Update stats
    function updateStats() {
      // Calculate average temperature
      const avgTemp = Math.round(rooms.reduce((sum, room) => sum + room.temp, 0) / rooms.length);
      avgTempEl.textContent = `${avgTemp}¬∞C`;
      
      // Count lights on
      const lightsOn = rooms.filter(room => room.lightOn).length;
      lightsOnEl.textContent = lightsOn;
      
      // Calculate total energy usage
      const totalEnergy = rooms.reduce((sum, room) => sum + room.energyUsage, 0).toFixed(1);
      energyUsageEl.textContent = `${totalEnergy} kWh`;
      
      // Update overview
      totalLightsEl.textContent = rooms.filter(r => r.lightOn).length;
      activeACEl.textContent = rooms.filter(r => r.acOn).length;
      activeHeatersEl.textContent = rooms.filter(r => r.heaterOn).length;
      
      const avgBrightness = Math.round(
        rooms.reduce((sum, room) => sum + room.brightness, 0) / rooms.length
      );
      avgBrightnessEl.textContent = `${avgBrightness}%`;
    }
    
    // Start simulation
    function startSimulation() {
      if (isSimulationRunning) return;
      
      isSimulationRunning = true;
      startBtn.disabled = true;
      stopBtn.disabled = false;
      startBtn.querySelector('.spinner').style.display = 'inline-block';
      
      addAlert('Simulation started', 'success');
      
      simulationInterval = setInterval(() => {
        simulationTime++;
        simTimeEl.textContent = `Sim time: ${simulationTime}s`;
        
        // Update room data
        rooms.forEach(room => {
          // Random temperature fluctuation
          const tempChange = (Math.random() - 0.5) * 0.5;
          room.temp = Math.round((room.temp + tempChange) * 10) / 10;
          
          // HVAC effects
          if (room.acOn) {
            room.temp = Math.max(16, room.temp - 0.3);
          }
          if (room.heaterOn) {
            room.temp = Math.min(30, room.temp + 0.3);
          }
          
          // Auto mode check
          if (room.autoMode) {
            checkAutoMode(room);
          }
          
          // Calculate energy usage
          let energy = 0;
          if (room.lightOn) {
            energy += 0.1 + (room.brightness / 100) * 0.4;
          }
          if (room.acOn) {
            energy += 0.8;
          }
          if (room.heaterOn) {
            energy += 0.6;
          }
          room.energyUsage = Math.round(energy * 10) / 10;
          
          // Temperature alerts
          if (room.temp > 28) {
            addAlert(`High temperature in ${room.name}: ${room.temp}¬∞C`, 'warning');
          }
          if (room.temp < 18) {
            addAlert(`Low temperature in ${room.name}: ${room.temp}¬∞C`, 'warning');
          }
        });
        
        // Update UI
        renderRoomCards();
        updateStats();
      }, updateInterval);
    }
    
    // Stop simulation
    function stopSimulation() {
      if (!isSimulationRunning) return;
      
      isSimulationRunning = false;
      startBtn.disabled = false;
      stopBtn.disabled = true;
      startBtn.querySelector('.spinner').style.display = 'none';
      
      clearInterval(simulationInterval);
      addAlert('Simulation stopped', 'info');
    }
    
    // Reset simulation
    function resetSimulation() {
      stopSimulation();
      simulationTime = 0;
      simTimeEl.textContent = 'Sim time: 0s';
      
      // Reset room data
      rooms.forEach(room => {
        room.temp = 20 + Math.random() * 10;
        room.targetTemp = 20 + Math.random() * 5;
        room.lightOn = Math.random() > 0.5;
        room.brightness = room.lightOn ? Math.floor(Math.random() * 100) : 0;
        room.acOn = false;
        room.heaterOn = false;
        room.autoMode = true;
        room.energyUsage = 0.2 + Math.random() * 0.8;
      });
      
      // Update UI
      renderRoomCards();
      updateStats();
      addAlert('Simulation reset', 'info');
    }
    
    // Logout
    function logout() {
      addAlert('Logging out...', 'info');
      setTimeout(() => {
        window.location.href = 'login.html';
      }, 1500);
    }
    
    // Add alert
    function addAlert(message, type = 'info') {
      const alertEl = document.createElement('div');
      alertEl.className = `alert ${type}`;
      alertEl.textContent = message;
      
      alertsEl.appendChild(alertEl);
      
      // Keep only last 5 alerts
      while (alertsEl.children.length > 5) {
        alertsEl.removeChild(alertsEl.firstChild);
      }
      
      // Scroll to bottom
      alertsEl.scrollTop = alertsEl.scrollHeight;
    }
  </script>
</body>
</html>